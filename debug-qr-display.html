<!DOCTYPE html>
<html>
<head>
    <title>QR Code Display Debug</title>
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            background-color: #f8f9fa;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .qr-container {
            text-align: center;
            margin: 20px 0;
        }
        .qr-code-img {
            max-width: 200px;
            height: auto;
            border: 1px solid #000;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>QR Code Display Debug</h1>
    
    <div class="test-section">
        <h2>Test 1: Simple QR Code Display</h2>
        <button id="test1">Generate and Display QR Code</button>
        <div id="result1" class="result"></div>
        <div id="qrDisplay1" class="qr-container"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Complex Data QR Code Display</h2>
        <button id="test2">Generate and Display Complex QR Code</button>
        <div id="result2" class="result"></div>
        <div id="qrDisplay2" class="qr-container"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Simulate Receipt QR Code</h2>
        <button id="test3">Generate Receipt-like QR Code</button>
        <div id="result3" class="result"></div>
        <div id="qrDisplay3" class="qr-container"></div>
    </div>

    <script>
        // Test data similar to what's used in the POS system
        const receiptData = {
            type: 'sales',
            receiptNumber: 'TEST-001',
            date: new Date().toISOString(),
            items: [
                { name: 'Product 1', quantity: 2, price: 10.00, total: 20.00 },
                { name: 'Product 2', quantity: 1, price: 15.00, total: 15.00 }
            ],
            subtotal: 35.00,
            tax: 0.00,
            discount: 0.00,
            total: 35.00,
            amountReceived: 40.00,
            change: 5.00
        };

        // Test 1: Simple QR Code Display
        document.getElementById('test1').addEventListener('click', async () => {
            const button = document.getElementById('test1');
            const result = document.getElementById('result1');
            const qrDisplay = document.getElementById('qrDisplay1');
            
            button.disabled = true;
            result.innerHTML = 'Generating...';
            result.className = 'result';
            qrDisplay.innerHTML = '';
            
            try {
                // Generate a simple QR code
                const dataUrl = await QRCode.toDataURL('Hello World', {
                    width: 120,
                    margin: 2,
                    errorCorrectionLevel: 'M'
                });
                
                // Try to display the image
                const img = document.createElement('img');
                img.src = dataUrl;
                img.className = 'qr-code-img';
                img.alt = 'QR Code';
                img.onerror = function() {
                    result.innerHTML += '<p><strong>Image failed to load!</strong></p>';
                    result.className = 'result error';
                    console.error('QR Code image failed to load:', this.src);
                };
                
                qrDisplay.appendChild(img);
                
                result.innerHTML = `
                    <p><strong>Success!</strong></p>
                    <p>QR Code displayed in page</p>
                    <p>Data URL length: ${dataUrl.length}</p>
                `;
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `
                    <p><strong>Error:</strong></p>
                    <p>${error.message}</p>
                    <pre>${error.stack}</pre>
                `;
                result.className = 'result error';
            } finally {
                button.disabled = false;
            }
        });

        // Test 2: Complex Data QR Code Display
        document.getElementById('test2').addEventListener('click', async () => {
            const button = document.getElementById('test2');
            const result = document.getElementById('result2');
            const qrDisplay = document.getElementById('qrDisplay2');
            
            button.disabled = true;
            result.innerHTML = 'Generating...';
            result.className = 'result';
            qrDisplay.innerHTML = '';
            
            try {
                const dataString = JSON.stringify(receiptData);
                const dataUrl = await QRCode.toDataURL(dataString, {
                    width: 120,
                    margin: 2,
                    errorCorrectionLevel: 'M',
                    type: 'image/png',
                    quality: 1,
                    color: {
                        dark: '#000000',
                        light: '#ffffff'
                    }
                });
                
                // Try to display the image
                const img = document.createElement('img');
                img.src = dataUrl;
                img.className = 'qr-code-img';
                img.alt = 'QR Code';
                img.onerror = function() {
                    result.innerHTML += '<p><strong>Image failed to load!</strong></p>';
                    result.className = 'result error';
                    console.error('QR Code image failed to load:', this.src);
                };
                
                qrDisplay.appendChild(img);
                
                result.innerHTML = `
                    <p><strong>Success!</strong></p>
                    <p>QR Code displayed in page</p>
                    <p>Data URL length: ${dataUrl.length}</p>
                    <p>Data string length: ${dataString.length}</p>
                `;
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `
                    <p><strong>Error:</strong></p>
                    <p>${error.message}</p>
                    <pre>${error.stack}</pre>
                `;
                result.className = 'result error';
            } finally {
                button.disabled = false;
            }
        });

        // Test 3: Simulate Receipt QR Code
        document.getElementById('test3').addEventListener('click', async () => {
            const button = document.getElementById('test3');
            const result = document.getElementById('result3');
            const qrDisplay = document.getElementById('qrDisplay3');
            
            button.disabled = true;
            result.innerHTML = 'Generating...';
            result.className = 'result';
            qrDisplay.innerHTML = '';
            
            try {
                const dataString = JSON.stringify(receiptData);
                const dataUrl = await QRCode.toDataURL(dataString, {
                    width: 120,
                    margin: 2,
                    errorCorrectionLevel: 'M',
                    type: 'image/png',
                    quality: 1,
                    color: {
                        dark: '#000000',
                        light: '#ffffff'
                    }
                });
                
                // Create HTML similar to the receipt
                const receiptHTML = `
                    <div style="text-align: center; max-width: 320px; margin: 0 auto; padding: 10px; font-family: 'Courier New', monospace;">
                        <div style="text-align: center; margin: 15px 0; padding: 10px; border-top: 1px dashed #000;">
                            <div style="font-size: 9px; margin-bottom: 5px;">Scan for Details</div>
                            <img src="${dataUrl}" 
                                 style="max-width: 120px; height: auto; margin: 10px auto; display: block;" 
                                 alt="Receipt QR Code" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block'; console.error('QR Code failed to load:', this.src)" />
                            <div style="display: none; font-size: 8px; color: #666; margin: 5px 0;">QR Code failed to load</div>
                            <div style="font-size: 8px; margin-top: 5px;">Receipt #: TEST-001</div>
                        </div>
                    </div>
                `;
                
                qrDisplay.innerHTML = receiptHTML;
                
                result.innerHTML = `
                    <p><strong>Success!</strong></p>
                    <p>Receipt-like HTML generated and displayed</p>
                    <p>Data URL length: ${dataUrl.length}</p>
                    <p>Data string length: ${dataString.length}</p>
                `;
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `
                    <p><strong>Error:</strong></p>
                    <p>${error.message}</p>
                    <pre>${error.stack}</pre>
                `;
                result.className = 'result error';
            } finally {
                button.disabled = false;
            }
        });
    </script>
</body>
</html>